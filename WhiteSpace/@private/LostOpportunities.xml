<script>
	<for var="gid" in="RevenueServices.Keys">
		<set var="IgnoreServiceUnmatched[gid]"  if="!IgnoreServiceUnmatched.ContainsKey(gid)">{new Dictionary()}</set>
		<for var="rid" in="RevenueServices[gid].Keys">
			<set var="json">{null}</set>
			<sandbox verbose="false">
				<set var="json">{Json.GetDictionary(RevenueServices[gid][rid].vs360_selectedcombinations)}</set>
			</sandbox>
			<if condition="json.isSet">
				<set var="practiceId">{null}</set>
				<for var="rule" in="json.rules">
					<for var="cond" in="rule.conditions">
						<if condition="cond._and.isSet">
							<for var="grp" in="cond._and">
								<if condition="grp.attr eq 'vs360_practiceareaid'">
                                    <set var="practiceId">{grp.value}</set>
                                </if>
							</for>
							
						</if>
						<if condition="cond._or.isSet">
							<for var="grp" in="cond._or">
								<if condition="grp.attr eq 'vs360_practiceareaid'">
                                    <set var="practiceId">{grp.value}</set>
                                </if>
							</for>
						</if>
                    </for>
					
				</for>
				<if condition="practiceId.isSet">
					<set var="IgnoreServiceUnmatched[gid][rid]"  if="!IgnoreServiceUnmatched[gid].ContainsKey(rid)">{new Dictionary()}</set>
                    <select from="crm" entity="oppportunity" var="records">
                        <where>
                            <condition attr="statuscode" op="eq">{2}</condition>
                        </where>
						<join type="inner" entity="vs360_practicearea" to="vs360_practiceareaid" from="vs360_practiceareaid" >
                            <where>
                                <condition attr="vs360_practiceareaid" op="eq">{practiceId}</condition>
                            </where>
                        </join>
                        <attr name="accountid"/>
                    </select>
					<for var="r" in="records">
                        <set var="IgnoreServiceUnmatched[gid][rid][r.accountid.ToString()]">{null}</set>
                    </for>
                </if>
			</if>
		 </for>	
	</for>
</script>