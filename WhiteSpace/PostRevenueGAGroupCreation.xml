<script>
	<set var="dumpFile">C:\temp\dump.csv</set>
	

	<select from="crm" entity="vs360_revenueservice" var="records">
		<where>
			<condition attr="statecode" op="eq">{0}</condition>
		</where>
		<attr name="vs360_name"/>
		<attr name="vs360_revenueserviceid"/>
		<attr name="vs360_selectedcombinations"/>
		<attr name="vs360_group" />
	</select>
	<set var="RevenueServices">{new Dictionary()}</set>
	<set var="RevenueServicesNG">{new Dictionary()}</set>
	<for var="r" in="records">
		<set var="rid">{r.vs360_revenueserviceid.ToString()}</set>
		<set var="RevenueServices[rid]">{r}</set>
		<set var="RevenueServicesNG[r.vs360_group+r.vs360_name]">{r}</set>
	</for>
	<set var="records">{Csv.Read(dumpFile, Encoding.UTF8, ',', '"')}</set>
	<for var="r" in="records">
		<if condition="r['UseThisGroup'] eq 'True'">
            <set var="jsonData">{Json.GetArrayFromJson(r['NewRecords'])}</set>
			<!--<log>{jsonData}</log>-->
			<for var="j" in="jsonData">
				<if condition="!RevenueServicesNG.ContainsKey(j.vs360_group+j.vs360_name)">
                    <create in="crm" entity="vs360_revenueservice" var="newRec">
                        <attr name="vs360_name">{j.vs360_name}</attr>
						<attr name="vs360_selectedcombinations">{j.vs360_selectedcombinations}</attr>
						<attr name="vs360_group">{j.vs360_group}</attr>
                    </create>
                </if>
            </for>
        </if>

    </for>
</script>