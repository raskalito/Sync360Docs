<script>
	<set var="l">{'{'}</set>
	<set var="template"><![CDATA[{l}
    "rules": [
        {l}
            "entity": "vs360_job",
            "field": "vs360_accountid",
            "conditions": [
                {l}
                    "_and": [
                        {l}
                            "attr": "vs360_practiceareaid",
                            "op": "eq",
                            "value": "GGGGGGGG",
							"type": "string"
                        },
                        {l}
                            "attr": "fol_fb5ytotal",
                            "op": "ge",
                            "value": 500,
							"type": "decimal"
                        }
                    ]
                }
            ],
            "links": [
                {l}
                    "type": "inner",
                    "relationship": "vs360_accountdata",
                    "to": "vs360_clientreferenceid",
                    "from": "vs360_accountdataid",
                    "conditions": [
                        {l}
                            "_and": [
                                {l}
                                    "attr": "vs360_clientenddate",
                                    "op": "null"
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}
	]]></set>
	<set var="Data">{new Dictionary()}</set>
	<set var="Data['0']">{new List()}</set>
	<set var="Data['0'][]"><attr name="code">0424</attr><attr name="grp">BL</attr></set>
	<set var="Data['0'][]"><attr name="code">0415</attr><attr name="grp">BL</attr></set>
	<set var="Data['0'][]"><attr name="code">0410</attr><attr name="grp">BL</attr></set>
	<set var="Data['0'][]"><attr name="code">0404</attr><attr name="grp">BL</attr></set>
	<set var="Data['0'][]"><attr name="code">0409</attr><attr name="grp">BL</attr></set>
	<set var="Data['0'][]"><attr name="code">0422</attr><attr name="grp">BL</attr></set>
	<set var="Data['0'][]"><attr name="code">0428</attr><attr name="grp">BL</attr></set>
	<set var="Data['0'][]"><attr name="code">0315</attr><attr name="grp">IP</attr></set>
	<set var="Data['0'][]"><attr name="code">0311</attr><attr name="grp">IP</attr></set>
	<set var="Data['0'][]"><attr name="code">0202</attr><attr name="grp">LT</attr></set>
	<set var="Data['0'][]"><attr name="code">0216</attr><attr name="grp">LT</attr></set>
	<set var="Data['0'][]"><attr name="code">0215</attr><attr name="grp">LT</attr></set>
	<set var="Data['0'][]"><attr name="code">0223</attr><attr name="grp">LT</attr></set>
	<set var="Data['0'][]"><attr name="code">0220</attr><attr name="grp">LT</attr></set>
	<set var="Data['0'][]"><attr name="code">0209</attr><attr name="grp">LT</attr></set>
	<set var="Data['0'][]"><attr name="code">0226</attr><attr name="grp">LT</attr></set>
	
	<for var="grp" in="Data.Keys">
        <for var="val" in="Data[grp]">
            <select from="crm" entity="vs360_practicearea" var="rec">
                <where>
                    <condition attr="fol_foleygroupcode" op="eq">{val.code}</condition>
                </where>
                <attr name="vs360_practiceareaid"/>
				<attr name="vs360_name"/>
            </select>
			<if condition="rec.Count gt 0">
				<set var="p">{rec[0]}</set>
				<set var="tx">{template}</set>
				<set var="tx">{tx.Replace('GGGGGGGG',p.vs360_practiceareaid.ToString())}</set>
				<set var="name">({val.grp}) {p.vs360_name}</set>
				<select from="crm" entity="vs360_revenueservice" var="rev">
                    <where>
                        <condition attr="vs360_name" op="eq">{name}</condition>
						<condition attr="statecode" op="eq">{0}</condition>
                    </where>
                    <attr name="vs360_revenueserviceid"/>
                </select>
				<if condition="rev.Count eq 0">
                    <create in="crm" entity="vs360_revenueservice" var="id">
                        <attr name="vs360_name">{name}</attr>
						<attr name="vs360_group">{grp as 'int'}</attr>
						<attr name="vs360_selectedcombinations">{tx}</attr>
                    </create>
                </if>
			</if>
        </for>
    </for>
</script>


